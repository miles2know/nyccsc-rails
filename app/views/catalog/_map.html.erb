
  
  <!-- default map / should default to NYS -->
  <ul class="nav nav-tabs overlay-tabs"></ul>

  <div class="mapResults" id="map" page="default-view" style="width:100%; height:600px;">
      <div id="loading" style="display: block;">
          <div class="loading-indicator">
              <div class="progress progress-striped active">
                  <div class="progress-bar progress-bar-info" style="width: 100%"></div>
              </div>
          </div>
      </div>
  </div>

  <div>&nbsp;</div>

  <div class="mapit">
    <button class="btn btn-default" id="add-overlay" href="#">Stream Gauges - Map It!</button>
  </div>

  <!-- for mapping application -->
  <%= javascript_include_tag 'mapDataOverlays' %>
  <%= javascript_include_tag 'mapAddD3Layer' %>
  <%= javascript_include_tag 'mapResults' %>
  <%= javascript_include_tag 'mapSearch' %>

  <!-- line below should include script below -->
  <% #javascript_include_tag 'mapInitialize' %>

  <script>

  //$(document).ready(function() {
    
    // var searchTerms = getUrlParameters("q", "", true);  

    // //setup map
    //   var map = L.map('map').setView([43.1393, -76], 7);

    //   // add initial layer to map  
    //   map.addLayer(OpenStreetMap_BlackAndWhite);

    //   // map is finished loading
    //   //$.when(mapResults.onLoad()).done(function() {
    //   $.when(map).done(function() {
        
    //     var svg = d3.select(map.getPanes().overlayPane).append("svg");

    //     //loop through possible overlays and add active layer
    //     for (var i = 0; i < contextOverlays.length; i++) {
    //       //console.log(contextOverlays[i].data_source);
    //       if (contextOverlays[i].active) {
    //         addPolygonLayerToMap(map,
    //             contextOverlays[i].data_source, 
    //             contextOverlays[i].data_name, 
    //             contextOverlays[i].active);
    //       }

    //       addOverlayButton(contextOverlays[i].data_name, contextOverlays[i].active);
    //     }
    //   });


    var searchTerms = getUrlParameters("q", "", true);

    //window finished loading (js)
    window.addEventListener("load", function() {

      //load map
      if(mapResults.verifyReady()) {

        // map is finished loading
        $.when(mapResults.onLoad()).done(function() {  
          //if search terms are found on map, highlight it
          if(searchTerms) {
            searchTerms.split("+").forEach(function(s) {
              // do stuff with myString;
              d3.selectAll(".area[title='"+s.toLowerCase()+"']").style("fill-opacity", ".6");
            
            });//end searchTerms loop
          }//end if

        });//end mapResults.onLoad() leaflet?? 

      }//end if

    });//end window load function 

  //});

  </script>
  

  
